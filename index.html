<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login System</title>
    <style>
        :root {
            --bg: #0f172a;
            --card: #1e293b;
            --primary: #38bdf8;
            --text: #f1f5f9;
            --secondary: #94a3b8;
            --error: #ef4444;
            --success: #10b981;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: Arial, sans-serif;
            background: var(--bg);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: var(--text);
        }

        .container {
            background: var(--card);
            padding: 40px;
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
        }

        h1 { text-align: center; margin-bottom: 20px; color: var(--primary); }
        .form-group { margin-bottom: 15px; }
        label { font-size: 14px; color: var(--secondary); }

        input, select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border-radius: 6px;
            border: 1px solid #334155;
            background: #0f172a;
            color: white;
        }

        button {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }

        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .message { margin-bottom: 15px; padding: 10px; border-radius: 6px; display: none; }
        .error { background: rgba(239,68,68,0.1); color: var(--error); }
        .success { background: rgba(16,185,129,0.1); color: var(--success); }
        .toggle { text-align: center; margin-top: 15px; font-size: 14px; }
        .toggle a { color: var(--primary); cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div id="signupForm">
        <h1>Create Account</h1>
        <div id="signupMsg" class="message"></div>
        <div class="form-group">
            <label>Email</label>
            <input type="email" id="signupEmail">
        </div>
        <div class="form-group">
            <label>Password</label>
            <input type="password" id="signupPassword">
        </div>
        <div class="form-group">
            <label>Confirm Password</label>
            <input type="password" id="confirmPassword">
        </div>
        <div class="form-group">
            <label>Select Role</label>
            <select id="signupRole">
                <option value="">Choose Role</option>
                <option value="candidate">Candidate</option>
                <option value="recruiter">Recruiter</option>
            </select>
        </div>
        <button id="signupBtn" onclick="signup()">Sign Up</button>
        <div class="toggle">Already have account? <a onclick="toggleForms()">Login</a></div>
    </div>

    <div id="loginForm" style="display:none;">
        <h1>Login</h1>
        <div id="loginMsg" class="message"></div>
        <div class="form-group">
            <label>Email</label>
            <input type="email" id="loginEmail">
        </div>
        <div class="form-group">
            <label>Password</label>
            <input type="password" id="loginPassword">
        </div>
        <button id="loginBtn" onclick="login()">Login</button>
        <div class="toggle">Don't have account? <a onclick="toggleForms()">Sign Up</a></div>
    </div>
</div>

<script>
    // USE YOUR DEPLOYMENT URL HERE
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz5YX4_pG5gWo4D_Tz95eDBynIJyzuM_mKru1VWubyhUahGGKJcxZQlZbNEZtxrlzAu/exec";

    function toggleForms() {
        const s = document.getElementById("signupForm");
        const l = document.getElementById("loginForm");
        s.style.display = s.style.display === "none" ? "block" : "none";
        l.style.display = l.style.display === "none" ? "block" : "none";
    }

    async function signup() {
        const email = signupEmail.value.trim();
        const password = signupPassword.value;
        const role = signupRole.value;
        const btn = document.getElementById("signupBtn");

        if (password !== confirmPassword.value) return show("signupMsg","Passwords do not match","error");
        if (!email || !password || !role) return show("signupMsg","Please fill all fields","error");

        btn.disabled = true;
        show("signupMsg", "Creating account...", "success");

        try {
            // POST with no-cors is fast for one-way data (Signup)
            await fetch(SCRIPT_URL, {
                method: "POST",
                mode: "no-cors",
                body: JSON.stringify({ action: "signup", email, password, role })
            });

            // Since we used no-cors, we assume success if no network error occurs
            show("signupMsg", "Success! Switch to login.", "success");
            setTimeout(toggleForms, 1500);
        } catch (err) {
            show("signupMsg", "Connection error", "error");
        } finally {
            btn.disabled = false;
        }
    }

    async function login() {
        const email = loginEmail.value.trim();
        const password = loginPassword.value;
        const btn = document.getElementById("loginBtn");

        if (!email || !password) return show("loginMsg","Enter email and password","error");

        btn.disabled = true;
        show("loginMsg", "Verifying...", "success");

        try {
            // We use GET for login so we can actually READ the response data bypass CORS issues
            const url = `${SCRIPT_URL}?action=login&email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`;
            const res = await fetch(url);
            const result = await res.json();

            if (result.success) {
                sessionStorage.setItem("userEmail", email);
                sessionStorage.setItem("userRole", result.role);
                window.location.href = result.role === "candidate" ? "dashboard.html" : "recruiter.html";
            } else {
                show("loginMsg", "Invalid email or password", "error");
            }
        } catch (err) {
            show("loginMsg", "Login failed. Check script deployment.", "error");
        } finally {
            btn.disabled = false;
        }
    }

    function show(id, msg, type) {
        const el = document.getElementById(id);
        el.innerText = msg;
        el.className = "message " + type;
        el.style.display = "block";
    }

    window.onload = function() {
        const email = sessionStorage.getItem("userEmail");
        const role = sessionStorage.getItem("userRole");
        if (email && role) {
            window.location.href = role === "candidate" ? "dashboard.html" : "recruiter.html";
        }
    }
</script>
</body>
</html>

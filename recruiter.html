<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HR Intel | AI Recruitment System</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
    --primary: #00f5d4;
    --secondary: #9b5de5;
    --bg-dark: #0f172a;
    --sidebar-width: 260px;
    --card-bg: rgba(30, 41, 59, 0.7);
    --danger: #ff4d4d;
}

body {
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    background: var(--bg-dark);
    color: #f8fafc;
    margin: 0;
    display: flex;
    min-height: 100vh;
}

.sidebar {
    width: var(--sidebar-width);
    background: #1e293b;
    height: 100vh;
    position: fixed;
    display: flex;
    flex-direction: column;
    border-right: 1px solid rgba(255,255,255,0.05);
}

.sidebar-header {
    padding: 30px 25px;
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--primary);
}

.nav-items-container { flex-grow: 1; }

.nav-item {
    padding: 15px 25px;
    cursor: pointer;
    color: #94a3b8;
    transition: 0.2s;
}

.nav-item:hover {
    background: rgba(255,255,255,0.05);
    color: white;
}

.nav-item.active {
    color: var(--primary);
    border-right: 4px solid var(--primary);
    background: rgba(0,245,212,0.05);
}

.logout-container {
    padding: 20px;
    border-top: 1px solid rgba(255,255,255,0.05);
}

.logout-btn {
    width: 100%;
    padding: 12px;
    background: transparent;
    color: var(--danger);
    border: 1px solid var(--danger);
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
}

.logout-btn:hover {
    background: var(--danger);
    color: white;
}

.main-content {
    margin-left: var(--sidebar-width);
    padding: 40px;
    width: calc(100% - var(--sidebar-width));
}

.view-section { display: none; }
.view-section.active { display: block; }

.container {
    background: var(--card-bg);
    padding: 25px;
    border-radius: 12px;
    margin-bottom: 25px;
}

.grid-4 {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
}

.stat-box {
    background: rgba(15, 23, 42, 0.5);
    padding: 20px;
    border-radius: 10px;
    text-align: center;
}

.stat-box h2 { color: var(--primary); margin: 10px 0 0; }

input[type="text"], input[type="file"] {
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #334155;
    background: #0f172a;
    color: white;
}

.primary-btn {
    background: var(--primary);
    color: #0f172a;
    font-weight: bold;
    padding: 12px 24px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
}

table { width: 100%; border-collapse: collapse; margin-top: 15px; }
th, td { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); }
th { color: var(--primary); }

canvas { max-height: 400px; }
</style>
</head>

<body>

<nav class="sidebar">
<div class="sidebar-header">HR Intel</div>
<div class="nav-items-container">
    <div class="nav-item active" onclick="showView('uploadView', this)">üìÅ Upload</div>
    <div class="nav-item" onclick="showView('statsView', this)">üìä Analytics</div>
    <div class="nav-item" onclick="showView('tableView', this)">üë• Candidates</div>
    <div class="nav-item" onclick="showView('aiView', this)">ü§ñ AI Recruiter</div>
</div>
<div class="logout-container">
    <button class="logout-btn" onclick="logout()">Logout</button>
</div>
</nav>

<main class="main-content">

<section id="uploadView" class="view-section active">
<h1>Upload Candidate Data</h1>
<p>CSV Columns Required:</p>
<p><b>Name, Skills, Experience, Location, Expected Salary</b></p>
<div class="container">
    <input type="file" id="csvFile" accept=".csv">
    <button class="primary-btn" onclick="loadCSV()">Process Dataset</button>
</div>
</section>

<section id="statsView" class="view-section">
<h1>Analytics Dashboard</h1>

<div class="grid-4">
    <div class="stat-box">
        <h4>Total Candidates</h4>
        <h2 id="totalCount">0</h2>
    </div>
    <div class="stat-box">
        <h4>Avg Experience</h4>
        <h2 id="avgExp">0</h2>
    </div>
    <div class="stat-box">
        <h4>Unique Skills</h4>
        <h2 id="uniqueSkills">0</h2>
    </div>
    <div class="stat-box">
        <h4>Avg Expected Salary</h4>
        <h2 id="avgSalary">0</h2>
    </div>
</div>

<div class="container">
    <h3>Skill Frequency</h3>
    <canvas id="skillChart"></canvas>
</div>

<div class="container">
    <h3>Salary Distribution</h3>
    <canvas id="salaryChart"></canvas>
</div>

</section>

<section id="tableView" class="view-section">
<h1>Candidate Database</h1>
<div class="container">
    <table id="dataTable"></table>
</div>
</section>

<section id="aiView" class="view-section">
<h1>AI Recruiter</h1>
<div class="container">
    <input type="text" id="roleInput" placeholder="Enter Job Role">
    <button class="primary-btn" onclick="runAIRecruiter()">Find Matches</button>
</div>
<div class="container">
    <table id="aiResultsTable"></table>
</div>
</section>

</main>

<script>
let originalData = [];
let charts = {};

function showView(id, el){
    if(originalData.length === 0 && id !== "uploadView"){
        alert("Upload CSV first");
        return;
    }
    document.querySelectorAll('.view-section').forEach(v=>v.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(v=>v.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    el.classList.add('active');
}

function loadCSV(){
    const file = document.getElementById("csvFile").files[0];
    if(!file) return alert("Select CSV file");

    Papa.parse(file,{
        header:true,
        dynamicTyping:true,
        complete:(res)=>{
            originalData = res.data.filter(r => r.Name);
            updateDashboard();
            alert("Loaded " + originalData.length + " candidates");
        }
    });
}

function updateDashboard(){
    document.getElementById("totalCount").innerText = originalData.length;

    const totalExp = originalData.reduce((a,b)=>a+(parseFloat(b.Experience)||0),0);
    document.getElementById("avgExp").innerText = 
        (totalExp/(originalData.length||1)).toFixed(1)+" yrs";

    const totalSalary = originalData.reduce((a,b)=>a+(parseFloat(b["Expected Salary"])||0),0);
    document.getElementById("avgSalary").innerText = 
        "‚Çπ "+(totalSalary/(originalData.length||1)).toFixed(2)+" LPA";

    const skillMap = {};
    originalData.forEach(r=>{
        if(r.Skills){
            r.Skills.split(",").forEach(s=>{
                const skill = s.trim();
                if(skill) skillMap[skill] = (skillMap[skill]||0)+1;
            });
        }
    });
    document.getElementById("uniqueSkills").innerText = Object.keys(skillMap).length;

    if(charts.skill) charts.skill.destroy();
    charts.skill = new Chart(document.getElementById("skillChart"),{
        type:'bar',
        data:{
            labels:Object.keys(skillMap),
            datasets:[{label:"Candidates",data:Object.values(skillMap)}]
        }
    });

    if(charts.salary) charts.salary.destroy();
    charts.salary = new Chart(document.getElementById("salaryChart"),{
        type:'bar',
        data:{
            labels:originalData.map(c=>c.Name),
            datasets:[{
                label:"Expected Salary (LPA)",
                data:originalData.map(c=>parseFloat(c["Expected Salary"])||0)
            }]
        }
    });

    renderTable();
}

function renderTable(){
    const table = document.getElementById("dataTable");
    if(originalData.length === 0) return;

    const headers = Object.keys(originalData[0]);
    table.innerHTML = "<tr>"+headers.map(h=>`<th>${h}</th>`).join("")+"</tr>";
    originalData.forEach(r=>{
        table.innerHTML += "<tr>"+headers.map(h=>`<td>${r[h]||""}</td>`).join("")+"</tr>";
    });
}

async function runAIRecruiter(){
    const role = document.getElementById("roleInput").value;
    if(!role) return alert("Enter role");

    const res = await fetch("https://salary-backend-nixpackspythonversion-310.up.railway.app/api/match_candidates",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({role:role,candidates:originalData})
    });

    const data = await res.json();
    displayResults(data.matches||[]);
}

function displayResults(results){
    const table = document.getElementById("aiResultsTable");
    if(results.length===0){
        table.innerHTML="<tr><td>No matches found</td></tr>";
        return;
    }
    const headers = Object.keys(results[0]);
    table.innerHTML="<tr>"+headers.map(h=>`<th>${h}</th>`).join("")+"</tr>";
    results.forEach(r=>{
        table.innerHTML+="<tr>"+headers.map(h=>`<td>${r[h]}</td>`).join("")+"</tr>";
    });
}

function logout(){
    sessionStorage.clear();
    window.location.href="index.html";
}
</script>

</body>
</html>

